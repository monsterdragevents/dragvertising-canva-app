import { jsx as _jsx } from "react/jsx-runtime";
import { UnreachableError } from '../../../../base/preconditions';
import classNames from 'classnames';
import 'react';
import { useThemedMedia } from '../../theme/escape_hatch';
import styles, { getStyle } from './base_icon.css';
const renderIcon = ({ className, style, glyph })=>{
    let children = null;
    let innerHtml;
    if (!glyph || typeof glyph === 'string') innerHtml = {
        __html: glyph
    };
    else {
        const GlyphComponent = glyph;
        children = _jsx(GlyphComponent, {});
    }
    return _jsx("span", {
        "aria-hidden": "true",
        className: className,
        style: style,
        dangerouslySetInnerHTML: innerHtml,
        children: children
    });
};
const createIconClass = (glyphs, { extraClassName, followDirection, defaultSize = 'medium' } = {})=>{
    const Component = (props)=>{
        const { className, size = defaultSize, tone, ...restProps } = props;
        const [glyph, sizeClassName] = getGlyphAndClassForSize(size, glyphs);
        const classes = classNames(className, sizeClassName, extraClassName, tone ? getStyle(tone) : undefined, {
            [styles.followDirection]: followDirection
        });
        return renderIcon({
            ...restProps,
            glyph,
            className: classes
        });
    };
    Component.glyphs = glyphs;
    Component.followDirection = followDirection;
    return Component;
};
export function getGlyphAndClassForSize(size, glyphs) {
    const fallbackGlyph = glyphs.medium || glyphs.small || glyphs.large || glyphs.tiny;
    switch(size){
        case 'tiny':
            return [
                glyphs.tiny || fallbackGlyph,
                styles.tiny
            ];
        case 'small':
            return [
                glyphs.small || fallbackGlyph,
                styles.small
            ];
        case 'medium':
            return [
                glyphs.medium || fallbackGlyph,
                styles.medium
            ];
        case 'large':
            return [
                glyphs.large || fallbackGlyph,
                styles.large
            ];
        default:
            throw new UnreachableError(size);
    }
}
export const Internal = {
    create: (sources, followDirection)=>createIconClass(sources, {
            followDirection
        }),
    createSpinning: (sources, followDirection)=>createIconClass(sources, {
            extraClassName: styles.spinning,
            followDirection
        }),
    createWithExtraClassname: (sources, extraClassName, followDirection, defaultSize)=>createIconClass(sources, {
            extraClassName,
            followDirection,
            defaultSize
        }),
    createThemed: (defaultMedia, themedMedia, followDirection)=>{
        const Icon = (props)=>{
            const media = useThemedMedia(themedMedia);
            const sources = {
                ...defaultMedia,
                ...media
            };
            const Component = createIconClass(sources, {
                followDirection
            });
            return _jsx(Component, {
                ...props,
                tone: "primary"
            });
        };
        Icon.glyphs = defaultMedia;
        Icon.followDirection = followDirection;
        return Icon;
    }
};
