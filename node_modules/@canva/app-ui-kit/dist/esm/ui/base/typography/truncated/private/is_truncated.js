import { memoize } from '../../../../../base/memoize';
import * as React from 'react';
import ResizeObserver from 'resize-observer-polyfill';
import { dangerouslyGetElement } from '../../../handle/handle';
const resizedEventName = 'resized';
const getResizeObserver = memoize(()=>new ResizeObserver((els)=>{
        for (const el of els)el.target.dispatchEvent(new Event(resizedEventName, {
            bubbles: false
        }));
    }));
export function useIsTruncated(text, measure = 'onRender') {
    const [ref, setRef] = React.useState(null);
    const [isTruncated, setIsTruncated] = React.useState(false);
    const target = dangerouslyGetElement(ref);
    const updateTruncated = React.useCallback(()=>{
        setIsTruncated(()=>{
            if (target == null) return false;
            return target.scrollWidth - target.offsetWidth > 0 || target.scrollHeight - target.offsetHeight > 1;
        });
    }, [
        target,
        setIsTruncated
    ]);
    React.useEffect(()=>{
        if (measure === 'onRender') updateTruncated();
        if (measure === 'onResize' && target) {
            target.addEventListener(resizedEventName, updateTruncated);
            const resizeObserver = getResizeObserver();
            resizeObserver.observe(target);
            return ()=>{
                target.removeEventListener(resizedEventName, updateTruncated);
                resizeObserver.unobserve(target);
            };
        }
    }, [
        target,
        text,
        measure,
        updateTruncated
    ]);
    return {
        ref: setRef,
        isTruncated
    };
}
