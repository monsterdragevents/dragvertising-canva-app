"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get WithThemeValues () {
        return WithThemeValues;
    },
    get WithThemedMedia () {
        return WithThemedMedia;
    },
    get useThemeValues () {
        return useThemeValues;
    },
    get useThemedMedia () {
        return useThemedMedia;
    }
});
const _preconditions = require('../../../base/preconditions');
const _mobx = require("mobx");
const _react = require("react");
const _internal = require("./internal");
function useThemeValues(ref, cssProperties, maybeStore) {
    const context = (0, _react.useContext)(_internal.ThemeContext);
    const store = maybeStore !== null && maybeStore !== void 0 ? maybeStore : context.store;
    const [value, setValue] = (0, _react.useState)();
    const callbackRef = (0, _react.useRef)(undefined);
    callbackRef.current = ()=>{
        const computedStyle = window.getComputedStyle(_preconditions.Preconditions.checkExists(ref.current));
        const cssPropertyEntries = Object.entries(cssProperties);
        setValue(cssPropertyEntries.reduce((acc, [key, cssProperty])=>{
            const value = computedStyle.getPropertyValue(cssProperty).trim();
            acc[key] = value === '' ? undefined : value;
            return acc;
        }, {}));
    };
    const timeoutRef = (0, _react.useRef)(undefined);
    (0, _react.useEffect)(()=>(0, _mobx.reaction)(()=>store.currentTheme, () => timeoutRef.current = window.setTimeout(()=>{
                var _callbackRef_current;
                return (_callbackRef_current = callbackRef.current) === null || _callbackRef_current === void 0 ? void 0 : _callbackRef_current.call(callbackRef);
            }), {
            fireImmediately: true
        }), [
        store
    ]);
    (0, _react.useEffect)(()=>()=>window.clearTimeout(timeoutRef.current), []);
    return value;
}
function WithThemeValues({ properties, children }) {
    const ref = (0, _react.useRef)(null);
    const values = useThemeValues(ref, properties);
    return children(ref, values);
}
function useThemedMedia(media, maybeStore) {
    const context = (0, _react.useContext)(_internal.ThemeContext);
    const store = maybeStore !== null && maybeStore !== void 0 ? maybeStore : context.store;
    const [theme, setTheme] = (0, _react.useState)(store.currentTheme);
    (0, _react.useEffect)(()=>(0, _mobx.autorun)(()=>setTheme(store.currentTheme)), [
        store
    ]);
    if (theme == null) return undefined;
    const themedMediaEntries = Object.entries(media);
    return themedMediaEntries.reduce((themedMedia, [key, mediaOptions])=>{
        themedMedia[key] = mediaOptions === null || mediaOptions === void 0 ? void 0 : mediaOptions[theme];
        return themedMedia;
    }, {});
}
function WithThemedMedia({ media, children }) {
    const values = useThemedMedia(media);
    return children(values);
}
