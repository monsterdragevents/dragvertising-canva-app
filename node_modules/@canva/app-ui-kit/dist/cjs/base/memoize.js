"use strict"
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "memoize", {
    enumerable: true,
    get: function() {
        return memoize;
    }
});
const _preconditions = require("./preconditions");
const _result = require("./result");
function isPromiseLike(p) {
    return p != null && p.then != null;
}
function memoize(fn, { invalidateOnError } = {
    invalidateOnError: false
}) {
    let promiseDidReject = false;
    let result;
    const memoFn = (...args)=>{
        _preconditions.Preconditions.checkArgument(args.length === 0);
        if (result == null || invalidateOnError && (!result.ok || promiseDidReject)) try {
            promiseDidReject = false;
            result = _result.Result.Ok(fn());
            if (isPromiseLike(result.value))
            result.value.then(null, (_e)=>promiseDidReject = true);
        } catch (e) {
            result = _result.Result.Err(e);
        }
        if (result.ok) return result.value;
        else throw result.error;
    };
    return memoFn;
}
